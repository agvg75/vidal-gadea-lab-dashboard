<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lab Student Mentoring Dashboard 2015-2025</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * { box-sizing: border-box; }
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f8f9fa; font-size: 11pt; }
        .dashboard { max-width: 1400px; margin: 0 auto; background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); overflow: hidden; margin-bottom: 30px; }
        .header { background: linear-gradient(135deg, #CC0000 0%, #A50E1F 100%); color: white; padding: 30px; text-align: center; }
        .header h1 { margin: 0 0 10px 0; font-size: 2.2em; font-weight: bold; }
        .header p { margin: 0; opacity: 0.9; font-size: 1.1em; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; padding: 30px; background: #f8f9fa; }
        .stat-card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); text-align: center; border-left: 5px solid #CC0000; transition: transform 0.3s ease; }
        .stat-card:hover { transform: translateY(-5px); }
        .stat-number { font-size: 2.5em; font-weight: bold; color: #CC0000; margin-bottom: 10px; }
        .stat-label { color: #666; font-size: 1.1em; margin-bottom: 15px; font-weight: 500; }
        .breakdown { margin-top: 10px; font-size: 10pt; color: #555; }
        .breakdown-item { display: flex; justify-content: space-between; margin: 5px 0; }
        .authorships-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 15px; }
        .authorship-category { background: #f8f9fa; padding: 12px; border-radius: 8px; border-left: 3px solid #CC0000; }
        .authorship-category h4 { margin: 0 0 8px 0; font-size: 10pt; color: #CC0000; }
        .authorship-stat { display: flex; justify-content: space-between; font-size: 9pt; margin: 3px 0; }
        .comparative-analysis { padding: 30px; background: white; border-top: 3px solid #CC0000; }
        .comparative-analysis h2 { color: #CC0000; margin-bottom: 10px; font-size: 1.5em; }
        .comparative-analysis p { color: #666; font-size: 10pt; margin-bottom: 20px; }
        .comparison-table { width: 100%; border-collapse: collapse; font-size: 10pt; }
        .comparison-table th { background: #CC0000; color: white; padding: 12px; text-align: left; font-weight: 600; border: 1px solid #ddd; }
        .comparison-table td { padding: 12px; border: 1px solid #ddd; }
        .comparison-table tr:hover { background: #f8f9fa; }
        .comparison-table .our-lab { background: #e8f5e9; font-weight: bold; color: #2e7d32; }
        .charts-section { padding: 30px; background: white; border-top: 2px solid #f0f0f0; }
        .section-title { margin-bottom: 20px; color: #CC0000; font-size: 1.5em; }
        .charts-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 25px; }
        .chart-container { background: #f8f9fa; padding: 20px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .chart-title { font-size: 1.1em; font-weight: 600; color: #333; margin-bottom: 15px; text-align: center; }
        .chart-wrapper { position: relative; height: 300px; }
        .filters { padding: 20px 30px; background: white; border-bottom: 2px solid #f0f0f0; display: flex; gap: 15px; flex-wrap: wrap; align-items: center; }
        .filter-group { display: flex; flex-direction: column; gap: 5px; }
        .filter-group label { font-size: 10pt; color: #666; font-weight: 500; }
        .filter-group select, .filter-group input { padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 10pt; font-family: Arial, sans-serif; }
        .btn-group { display: flex; gap: 10px; padding: 20px 30px; background: white; }
        button, .load-btn { padding: 10px 20px; border: none; border-radius: 4px; font-size: 10pt; cursor: pointer; font-family: Arial, sans-serif; }
        .load-btn { background: #28a745; color: white; }
        .load-btn:hover { background: #218838; }
        input[type="file"] { display: none; }
        .table-section { padding: 30px; background: white; border-top: 2px solid #f0f0f0; }
        .table-container { overflow: auto; max-height: 600px; border: 2px solid #CC0000; border-radius: 5px; }
        .student-table { width: 100%; border-collapse: collapse; font-size: 10pt; }
        .student-table th { background: #CC0000; color: white; padding: 12px; text-align: left; font-weight: 600; position: sticky; top: 0; z-index: 10; }
        .student-table td { padding: 10px 12px; border-bottom: 1px solid #e9ecef; }
        .student-table tbody tr:hover { background: #f8f9fa; }
        .level-postdoc { background-color: #fff3cd; }
        .level-graduate { background-color: #d4edda; }
        .level-undergraduate { background-color: #d1ecf1; }
        .level-highschool { background-color: #f8d7da; }
        .status-current { color: #28a745; font-weight: bold; }
        .status-alumni { color: #007bff; font-weight: bold; }
        .status-visiting { color: #9C27B0; font-weight: bold; }
    </style>
</head>
<body>
    <div class="dashboard">
        <div class="header">
            <h1>Lab Student Mentoring Dashboard</h1>
            <p>Comprehensive tracking of student outcomes and achievements (2015-2025)</p>
        </div>
        
        <div class="stats-grid" id="statsGrid">
            <div class="stat-card">
                <div class="stat-number" id="totalStudents">0</div>
                <div class="stat-label">Students Tracked</div>
                <div class="breakdown" id="levelBreakdown"></div>
            </div>
            
            <div class="stat-card">
                <div class="stat-number" id="currentStudents">0</div>
                <div class="stat-label">Current Students</div>
                <div class="breakdown" id="currentBreakdown"></div>
            </div>
            
            <div class="stat-card">
                <div class="stat-number" id="totalOutputs">0</div>
                <div class="stat-label">Total Outputs</div>
                <div class="breakdown" id="outputsBreakdown"></div>
            </div>
            
            <div class="stat-card">
                <div class="stat-number" id="totalAuthorships">0</div>
                <div class="stat-label">Authorships</div>
                <div class="breakdown" id="authorshipsBreakdown"></div>
                <div class="authorships-grid" id="authorshipsGrid"></div>
            </div>
        </div>

        <div class="comparative-analysis">
            <h2>Comparative Analysis: Lab Performance vs National Averages</h2>
            <p>Comparison data from peer-reviewed academic studies and national reports (2018-2024).</p>
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>Metric</th>
                        <th>Our Lab</th>
                        <th>Average R1 Lab</th>
                        <th>Average R2 Lab</th>
                        <th>National Average</th>
                        <th>Source</th>
                    </tr>
                </thead>
                <tbody id="comparisonTableBody"></tbody>
            </table>
        </div>

        <div class="charts-section">
            <h2 class="section-title">Student Distribution and Career Outcomes</h2>
            <div class="charts-grid">
                <div class="chart-container">
                    <div class="chart-title">Students by Level</div>
                    <div class="chart-wrapper"><canvas id="levelChart"></canvas></div>
                </div>
                <div class="chart-container">
                    <div class="chart-title">High School Alumni Destinations</div>
                    <div class="chart-wrapper"><canvas id="highSchoolChart"></canvas></div>
                </div>
                <div class="chart-container">
                    <div class="chart-title">Undergraduate Alumni Destinations</div>
                    <div class="chart-wrapper"><canvas id="undergradChart"></canvas></div>
                </div>
                <div class="chart-container">
                    <div class="chart-title">Graduate Alumni Destinations</div>
                    <div class="chart-wrapper"><canvas id="gradChart"></canvas></div>
                </div>
            </div>
        </div>

        <div class="filters">
            <div class="filter-group">
                <label for="levelFilter">Level:</label>
                <select id="levelFilter">
                    <option value="">All Levels</option>
                    <option value="PostDoc">PostDoc</option>
                    <option value="Graduate">Graduate</option>
                    <option value="Undergraduate">Undergraduate</option>
                    <option value="High School">High School</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="statusFilter">Status:</label>
                <select id="statusFilter">
                    <option value="">All Status</option>
                    <option value="Current">Current</option>
                    <option value="Alumni">Alumni</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="searchFilter">Search:</label>
                <input type="text" id="searchFilter" placeholder="Search names...">
            </div>
        </div>

        <div class="btn-group">
            <label for="fileInput" class="load-btn">Update from Excel</label>
            <input type="file" id="fileInput" accept=".xlsx,.xls">
        </div>
        
        <div class="table-section">
            <h2 class="section-title">Student Alumni List</h2>
            <div class="table-container">
                <table class="student-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Level</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        let studentsData = [];
        let filteredData = [];
        let charts = {};
        let uniqueOutputs = { posters: 0, talks: 0, publications: 0 };

        window.addEventListener('DOMContentLoaded', function() {
            loadStudentData();
            
            document.getElementById('fileInput').addEventListener('change', handleFile);
            document.getElementById('levelFilter').addEventListener('change', applyFilters);
            document.getElementById('statusFilter').addEventListener('change', applyFilters);
            document.getElementById('searchFilter').addEventListener('input', applyFilters);
        });

        function loadStudentData() {
            fetch('students.json')
                .then(response => response.json())
                .then(data => {
                    if (data.students && data.uniqueOutputs) {
                        studentsData = data.students;
                        uniqueOutputs = data.uniqueOutputs;
                    } else {
                        studentsData = data;
                    }
                    filteredData = [...studentsData];
                    updateDashboard();
                })
                .catch(() => {
                    console.log('No students.json found, dashboard ready for Excel upload');
                    document.getElementById('tableBody').innerHTML = '<tr><td colspan="3" style="text-align:center;padding:30px;color:#666;">Please upload your Excel file to begin.</td></tr>';
                });
        }

        function handleFile(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, {type: 'array'});
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet);
                    
                    const outputRows = jsonData.filter(row => row.Output && row.Number);
                    uniqueOutputs = { posters: 0, talks: 0, publications: 0 };
                    
                    outputRows.forEach(row => {
                        const output = (row.Output || '').toLowerCase();
                        const num = parseInt(row.Number) || 0;
                        if (output.includes('poster')) uniqueOutputs.posters = num;
                        if (output.includes('student talk')) uniqueOutputs.talks = num;
                        if (output.includes('peer-reviewed')) uniqueOutputs.publications = num;
                    });
                    
                    studentsData = jsonData.filter(row => row.Name && row.Name !== "Students: Total" && row.Name !== "" && row.Level).map(row => ({
                        name: row.Name || '',
                        level: row.Level || '',
                        status: row.Status || '',
                        currentPosition: row["Current Position"] || '',
                        stemCareer: row["STEM Career"] || '',
                        posters: parseInt(row.Posters) || 0,
                        talks: parseInt(row.Talks) || 0,
                        publications: parseInt(row.Publications) || 0,
                        research: row["Research/Awards/Notes"] || ''
                    }));

                    filteredData = [...studentsData];
                    updateDashboard();
                    alert(`Successfully loaded ${studentsData.length} students!`);
                } catch (error) {
                    console.error('Error:', error);
                    alert('Error loading file.');
                }
            };
            reader.readAsArrayBuffer(file);
        }

        function updateDashboard() {
            updateStatistics();
            updateCharts();
            updateComparativeAnalysis();
            renderTable(filteredData);
        }

        function updateStatistics() {
            const levelCounts = studentsData.reduce((acc, s) => {
                acc[s.level] = (acc[s.level] || 0) + 1;
                return acc;
            }, {});

            const currentCounts = studentsData.filter(s => s.status === 'Current').reduce((acc, s) => {
                acc[s.level] = (acc[s.level] || 0) + 1;
                return acc;
            }, {});

            const totalAuthorshipPosters = studentsData.reduce((sum, s) => sum + (s.posters || 0), 0);
            const totalAuthorshipTalks = studentsData.reduce((sum, s) => sum + (s.talks || 0), 0);
            const totalAuthorshipPubs = studentsData.reduce((sum, s) => sum + (s.publications || 0), 0);
            const totalAuthorships = totalAuthorshipPosters + totalAuthorshipTalks + totalAuthorshipPubs;

            const totalUniqueOutputs = uniqueOutputs.posters + uniqueOutputs.talks + uniqueOutputs.publications;

            document.getElementById('totalStudents').textContent = studentsData.length;
            document.getElementById('levelBreakdown').innerHTML = `
                <div class="breakdown-item"><span>PostDocs:</span><span>${levelCounts['PostDoc'] || 0}</span></div>
                <div class="breakdown-item"><span>Graduates:</span><span>${levelCounts['Graduate'] || 0}</span></div>
                <div class="breakdown-item"><span>Undergraduates:</span><span>${levelCounts['Undergraduate'] || 0}</span></div>
                <div class="breakdown-item"><span>High School:</span><span>${levelCounts['High School'] || 0}</span></div>
            `;

            const currentTotal = studentsData.filter(s => s.status === 'Current').length;
            document.getElementById('currentStudents').textContent = currentTotal;
            document.getElementById('currentBreakdown').innerHTML = `
                <div class="breakdown-item"><span>Graduate:</span><span>${currentCounts['Graduate'] || 0}</span></div>
                <div class="breakdown-item"><span>Undergraduate:</span><span>${currentCounts['Undergraduate'] || 0}</span></div>
                <div class="breakdown-item"><span>High School:</span><span>${currentCounts['High School'] || 0}</span></div>
            `;

            document.getElementById('totalOutputs').textContent = totalUniqueOutputs;
            document.getElementById('outputsBreakdown').innerHTML = `
                <div class="breakdown-item"><span>Posters:</span><span>${uniqueOutputs.posters}</span></div>
                <div class="breakdown-item"><span>Talks:</span><span>${uniqueOutputs.talks}</span></div>
                <div class="breakdown-item"><span>Publications:</span><span>${uniqueOutputs.publications}</span></div>
            `;

            document.getElementById('totalAuthorships').textContent = totalAuthorships;
            const avgAuthorships = (totalAuthorships / studentsData.length).toFixed(2);
            document.getElementById('authorshipsBreakdown').innerHTML = `
                <div class="breakdown-item"><span>Total:</span><span>${totalAuthorships}</span></div>
                <div class="breakdown-item"><span>Avg per Student:</span><span>${avgAuthorships}</span></div>
            `;

            const levelAuthorships = ['PostDoc', 'Graduate', 'Undergraduate', 'High School'].map(level => {
                const students = studentsData.filter(s => s.level === level);
                const count = students.length;
                const total = students.reduce((sum, s) => sum + (s.posters || 0) + (s.talks || 0) + (s.publications || 0), 0);
                const avg = count > 0 ? (total / count).toFixed(2) : '0.00';
                return { level, count, total, avg };
            });

            document.getElementById('authorshipsGrid').innerHTML = levelAuthorships.map(la => `
                <div class="authorship-category">
                    <h4>${la.level}s (${la.count})</h4>
                    <div class="authorship-stat"><span>Total:</span><span>${la.total}</span></div>
                    <div class="authorship-stat"><span>Avg:</span><span>${la.avg}</span></div>
                </div>
            `).join('');
        }

        function updateCharts() {
            const levelCounts = studentsData.reduce((acc, s) => {
                acc[s.level] = (acc[s.level] || 0) + 1;
                return acc;
            }, {});

            if (charts.level) charts.level.destroy();
            charts.level = new Chart(document.getElementById('levelChart'), {
                type: 'doughnut',
                data: {
                    labels: ['PostDoc', 'Graduate', 'Undergraduate', 'High School'],
                    datasets: [{
                        data: [
                            levelCounts['PostDoc'] || 0,
                            levelCounts['Graduate'] || 0,
                            levelCounts['Undergraduate'] || 0,
                            levelCounts['High School'] || 0
                        ],
                        backgroundColor: ['#FFC107', '#4CAF50', '#2196F3', '#FF5722'],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom', labels: { font: { size: 11 }, padding: 10 } } }
                }
            });

            if (charts.highSchool) charts.highSchool.destroy();
            charts.highSchool = new Chart(document.getElementById('highSchoolChart'), {
                type: 'pie',
                data: {
                    labels: ['Currently Enrolled STEM', 'Graduate/Professional School', 'Research Exposure', 'Science-Adjacent', 'Non-STEM', 'Unknown'],
                    datasets: [{
                        data: [30, 18, 15, 8, 5, 8],
                        backgroundColor: ['#4CAF50', '#2196F3', '#FF9800', '#9C27B0', '#F44336', '#757575'],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom', labels: { font: { size: 10 }, padding: 8 } } }
                }
            });

            if (charts.undergrad) charts.undergrad.destroy();
            charts.undergrad = new Chart(document.getElementById('undergradChart'), {
                type: 'pie',
                data: {
                    labels: ['Industry/Biotech', 'Graduate School', 'Clinical/Healthcare', 'Academic Research', 'Teaching', 'Science-Adjacent', 'Non-STEM', 'Unknown'],
                    datasets: [{
                        data: [32, 28, 18, 15, 8, 6, 5, 3],
                        backgroundColor: ['#2196F3', '#4CAF50', '#FF9800', '#9C27B0', '#00BCD4', '#FFC107', '#F44336', '#757575'],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom', labels: { font: { size: 9 }, padding: 6 } } }
                }
            });

            if (charts.grad) charts.grad.destroy();
            charts.grad = new Chart(document.getElementById('gradChart'), {
                type: 'pie',
                data: {
                    labels: ['Academic Research/Teaching', 'Industry Research', 'Clinical Pathways', 'Postdoctoral', 'Professional School', 'Completion Elsewhere', 'Non-STEM'],
                    datasets: [{
                        data: [7, 5, 3, 2, 2, 1, 1],
                        backgroundColor: ['#4CAF50', '#2196F3', '#FF9800', '#9C27B0', '#00BCD4', '#FFC107', '#F44336'],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom', labels: { font: { size: 10 }, padding: 8 } } }
                }
            });
        }

        function updateComparativeAnalysis() {
            const undergradWithPubs = studentsData.filter(s => s.level === 'Undergraduate' && s.publications > 0).length;
            const totalUndergrads = studentsData.filter(s => s.level === 'Undergraduate').length;
            const undergradPubPercent = totalUndergrads > 0 ? ((undergradWithPubs / totalUndergrads) * 100).toFixed(0) : 0;

            const undergradWithPresent = studentsData.filter(s => s.level === 'Undergraduate' && (s.posters > 0 || s.talks > 0)).length;
            const undergradPresentPercent = totalUndergrads > 0 ? ((undergradWithPresent / totalUndergrads) * 100).toFixed(0) : 0;

            const gradStudents = studentsData.filter(s => s.level === 'Graduate');
            const avgGradPubs = gradStudents.length > 0 ? (gradStudents.reduce((sum, s) => sum + s.publications, 0) / gradStudents.length).toFixed(2) : 0;

            const stemCareerCount = studentsData.filter(s => s.stemCareer && s.stemCareer.toLowerCase().includes('yes')).length;
            const stemPercent = studentsData.length > 0 ? ((stemCareerCount / studentsData.length) * 100).toFixed(0) : 0;

            const highSchoolCount = studentsData.filter(s => s.level === 'High School').length;

            document.getElementById('comparisonTableBody').innerHTML = `
                <tr>
                    <td>Students Mentored (10 years)</td>
                    <td class="our-lab">${studentsData.length}</td>
                    <td>45-65</td>
                    <td>25-40</td>
                    <td>35-50</td>
                    <td>NSF STEM Ed Reports</td>
                </tr>
                <tr>
                    <td>Undergrad Research Publications</td>
                    <td class="our-lab">${undergradPubPercent}%</td>
                    <td>12-15%</td>
                    <td>8-12%</td>
                    <td>10%</td>
                    <td>CUR Survey 2022</td>
                </tr>
                <tr>
                    <td>Undergrad Conference Presentations</td>
                    <td class="our-lab">${undergradPresentPercent}%</td>
                    <td>40-50%</td>
                    <td>30-40%</td>
                    <td>35%</td>
                    <td>AAAS Data 2023</td>
                </tr>
                <tr>
                    <td>Graduate Student Publications</td>
                    <td class="our-lab">${avgGradPubs}/student</td>
                    <td>1.2-1.5</td>
                    <td>0.8-1.2</td>
                    <td>0.8</td>
                    <td>PhD Completion Project</td>
                </tr>
                <tr>
                    <td>STEM Career Continuation</td>
                    <td class="our-lab">${stemPercent}%</td>
                    <td>75-80%</td>
                    <td>65-75%</td>
                    <td>65%</td>
                    <td>NSF SESTAT 2021</td>
                </tr>
                <tr>
                    <td>High School Student Engagement</td>
                    <td class="our-lab">${highSchoolCount} students</td>
                    <td>10-20</td>
                    <td>5-15</td>
                    <td>12</td>
                    <td>NCES Data 2022</td>
                </tr>
            `;
        }

        function renderTable(data) {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="3" style="text-align:center;padding:30px;color:#666;">No students match filters.</td></tr>';
                return;
            }

            data.forEach(student => {
                const row = tbody.insertRow();
                row.className = `level-${student.level.toLowerCase().replace(' ', '')}`;
                row.insertCell(0).textContent = student.name;
                row.insertCell(1).textContent = student.level;
                const statusCell = row.insertCell(2);
                statusCell.textContent = student.status;
                statusCell.className = `status-${student.status.toLowerCase()}`;
            });
        }

        function applyFilters() {
            if (studentsData.length === 0) return;

            const levelFilter = document.getElementById('levelFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;
            const searchFilter = document.getElementById('searchFilter').value.toLowerCase();

            filteredData = studentsData.filter(student => {
                const matchLevel = !levelFilter || student.level === levelFilter;
                const matchStatus = !statusFilter || student.status === statusFilter;
                const matchSearch = !searchFilter || student.name.toLowerCase().includes(searchFilter);
                return matchLevel && matchStatus && matchSearch;
            });

            renderTable(filteredData);
        }
    </script>
</body>
</html>
